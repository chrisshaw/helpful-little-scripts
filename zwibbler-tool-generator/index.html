<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zwibbler Tool Generator</title>
  <link rel="stylesheet" href="style.css">
  <!-- Zwibbler must be loaded from your licensed copy -->
  <script src="zwibbler.js"></script>
</head>
<body>

<div id="app">
  <div zwibbler z-controller="initApp">

    <!-- Top bar -->
    <header id="top-bar">
      <h1>Zwibbler + AI Tool Generator</h1>
      <div id="top-actions">
        <button z-click="undo()" z-disabled="!canUndo()">Undo</button>
        <button z-click="redo()" z-disabled="!canRedo()">Redo</button>
        <button z-click="zoomIn()">Zoom +</button>
        <button z-click="zoomOut()">Zoom &minus;</button>
      </div>
    </header>

    <div id="main-layout">

      <!-- Left toolbar -->
      <aside id="toolbar">
        <div class="tool-section">
          <h3>Drawing</h3>
          <button z-click="usePickTool()" z-class="{'active': getCurrentTool()==='pick'}">Select</button>
          <button z-click="useBrushTool()" z-class="{'active': getCurrentTool()==='brush'}">Pen</button>
          <button z-click="useLineTool()" z-class="{'active': getCurrentTool()==='line'}">Line</button>
          <button z-click="useRectangleTool()" z-class="{'active': getCurrentTool()==='rectangle'}">Rectangle</button>
          <button z-click="useCircleTool()" z-class="{'active': getCurrentTool()==='circle'}">Circle</button>
          <button z-click="useTextTool()" z-class="{'active': getCurrentTool()==='text'}">Text</button>
        </div>

        <div class="tool-section">
          <h3>AI Tools</h3>
          <button id="btn-generate" z-click="openGenerator()">+ Generate Tool</button>
          <div id="generated-tools-list" z-for="tool in generatedTools">
            <button
              class="generated-tool-btn"
              z-click="placeGeneratedTool(tool)"
              z-text="tool.label"
            ></button>
          </div>
        </div>
      </aside>

      <!-- Canvas -->
      <div id="canvas-area">
        <div z-canvas></div>
      </div>

    </div>
  </div>
</div>

<!-- Tool Generator Dialog -->
<div id="generator-overlay" class="overlay hidden">
  <div id="generator-dialog">
    <div id="generator-header">
      <h2>Generate an Academic Tool</h2>
      <button id="generator-close" onclick="closeGenerator()">&times;</button>
    </div>

    <div id="generator-body">
      <label for="tool-prompt">Describe the tool you need:</label>
      <textarea
        id="tool-prompt"
        rows="4"
        placeholder="e.g., A simple calculator with basic arithmetic, a periodic table of elements, a unit converter for physics, an interactive number line..."
      ></textarea>

      <div id="category-hints">
        <span class="hint-chip" onclick="setPromptHint(this)">Calculator</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Graph paper</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Periodic table</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Unit converter</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Number line</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Multiplication table</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Fraction visualizer</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Protractor</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Coordinate plane</span>
        <span class="hint-chip" onclick="setPromptHint(this)">Timer / Stopwatch</span>
      </div>

      <div id="generator-options">
        <label>
          <span>Size:</span>
          <select id="tool-size">
            <option value="small">Small (300x200)</option>
            <option value="medium" selected>Medium (450x350)</option>
            <option value="large">Large (600x500)</option>
          </select>
        </label>
      </div>

      <button id="btn-do-generate" onclick="doGenerate()">Generate Tool</button>

      <div id="generator-status" class="hidden">
        <div class="spinner"></div>
        <span id="status-text">Generating your tool...</span>
      </div>

      <div id="generator-preview" class="hidden">
        <h3>Preview</h3>
        <div id="preview-frame-wrapper">
          <iframe id="preview-frame" sandbox="allow-scripts"></iframe>
        </div>
        <div id="preview-actions">
          <button onclick="acceptTool()">Place on Canvas</button>
          <button onclick="regenerateTool()">Regenerate</button>
          <button onclick="closeGenerator()">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="tool-generator.js"></script>
<script src="sandbox.js"></script>
<script src="app.js"></script>
</body>
</html>
